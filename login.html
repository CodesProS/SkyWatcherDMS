<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SkyWatcher</title>

    <!-- CSS -->
    <link rel="stylesheet" href="login.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Lettering.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.6.1/jquery.lettering.min.js"></script>

  <!-- Textillate.js -->
  <script src="https://cdn.rawgit.com/jschr/textillate/master/jquery.textillate.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@mojs/core"></script>

    <!-- Boxicons CSS -->
    <link href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css" rel="stylesheet" />
  </head>

  <body>
    <div class="lightning-effect"></div>
    <div class="horizontal round" style="width: 60%; height: 600px; backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px); padding: 0%; padding-top: 5px; padding-bottom: 5px; margin-right: 5px; background-color: #1c1b29">
      <div style="height: 100%; width: 40%; margin-right: auto; margin-left: 50px; display: flex;
      justify-content: space-between; flex-wrap: wrap;" id="cloud-container">
        <br>
        <br>
        <h1 style="color: white; width: 100%; text-align: center; margin-top: 15px;">SkyWatcher</h1>
        <br>
        <br>
        <br>
        <br>
        <img id="cloud1" class="cloudright" src="Images\cloud.png" alt="Cloud Image">
        <br>
                <img id="cloud2" class="cloudleft" src="Images\cloud.png" alt="Cloud Image">
                <br>
                <img id="cloud3" class="cloudright" src="Images\cloud.png" alt="Cloud Image">
                <br>
                <img id="dcloud" class="cloudleft" src="Images\cloud.png" alt="Cloud Image">
      </div>

      <div id="container" class="container" style="width: 45%; height: 100%; align-items: center;">
        <center><img src="Images/sunny.png" height="100px" width="100px"></center>

        <!--<center><div id="lottie" style="height: 100px; width: 100px;"></div></center>-->
        <center><h2>Welcome back!</h2></center>

        <form action="login_register.php" method="POST">
          <input type="hidden" name="action" value="login">
          <input type="hidden" name="isadmin" value="No">
          <div class="field email-field">
            <div class="input-field">
              <input type="username" placeholder="Enter your username" class="email" name="lusername" />
            </div>
            <span class="error email-error">
              <i class="bx bx-error-circle error-icon"></i>
              <p class="error-text">Username must be 3-15 characters long and can only contain letters, numbers, and underscores.</p>
            </span>
          </div>

          <div class="field create-password">
            <div class="input-field">
              <input type="password" placeholder="Enter Password" class="password" name="lpassword" />
              <i class="bx bx-hide show-hide"></i>
            </div>
            <span class="error password-error">
              <i class="bx bx-error-circle error-icon"></i>
              <p class="error-text">Please enter at least 8 characters with number, symbol, small, and capital letter.</p>
            </span>
          </div>

          <div class="input-field button">
            <input type="submit" value="Login" />
          </div>

          <div class="line-container">
            <hr class="line">
            <p class="or-text">Or Register</p>
            <hr class="line">
          </div>

          <h5>Don't have an account? <a href="#" id="reg">Register</a></h5>
        </form>
      </div>

      <div class="container" id="registerform" style="display: none; height: 100%; width: 45%;">
        <center><img src="Images/profile.png" height="100px" width="100px"></center>
        <header>Signup</header>
        <form action="login_register.php" method="POST">
          <input type="hidden" name="action" value="Register">
          <div class="user-details">
        
            <div class="input-box">
              <input type="name" placeholder="FirstName" name="rfname" id="rfname" />
            </div>
  
            <div class="input-box">
              <input type="name" placeholder="LastName" name="rlname" id="rlname" />
            </div>
          </div>

          <div class="field email-field">
            <div class="input-field">
              <input type="username" placeholder="Enter your username" class="email" name="rusername" id="rusername" />
            </div>
            <span class="error username-error">
              <i class="bx bx-error-circle error-icon"></i>
              <p class="error-text">Username must be 3-15 characters long and can only contain letters, numbers, and underscores.</p>
            </span>
          </div>
          <div class="field create-password">
            <div class="input-field">
              <input
                type="password"
                placeholder="Create password"
                class="password"
                name="rpassword"
                id="rpassword"
              />
              <i class="bx bx-hide show-hide"></i>
            </div>
            <span class="error password-error">
              <i class="bx bx-error-circle error-icon"></i>
              <p class="error-text">
                Please enter at least 8 characters with number, symbol, small and
                capital letter.
              </p>
            </span>
          </div>
          
        <h5>Already have an account? <a href="#" id="log">Login now</a></h5>
  
  
          <div class="input-field button">
            <input type="submit" name="action" value="Register" />
          </div>
        </form>
    </div>

    <!-- Form Validation Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Switching between Login and Register forms
        document.getElementById("reg").addEventListener("click", function () {
          document.getElementById("container").style.display = "none";
          document.getElementById("registerform").style.display = "block";
        });
      
        document.getElementById("log").addEventListener("click", function () {
          document.getElementById("container").style.display = "block";
          document.getElementById("registerform").style.display = "none";
        });
      
        const loginForm = document.querySelector("#container form"),
          loginEmailField = loginForm.querySelector(".email-field"),
          loginEmailInput = loginEmailField.querySelector(".email"),
          loginPassField = loginForm.querySelector(".create-password"),
          loginPassInput = loginPassField.querySelector(".password");
      
        // For Register Form (registerform)
        const registerForm = document.querySelector("#registerform form"),
          registerEmailField = registerForm.querySelector(".email-field"),
          registerEmailInput = registerEmailField.querySelector(".email"),
          registerPassField = registerForm.querySelector(".create-password"),
          registerPassInput = registerPassField.querySelector(".password");
      
        // Email Validation
        function checkEmail(emailInput, emailField) {
          const usernamePattern = /^[a-zA-Z0-9_]{3,15}$/;
          if (!emailInput.value.match(usernamePattern)) {
            return emailField.classList.add("invalid");
          }
          emailField.classList.remove("invalid");
        }
      
        // Password Validation
        function checkPassword(passInput, passField) {
          const passPattern =
            /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
          if (!passInput.value.match(passPattern)) {
            return passField.classList.add("invalid");
          }
          passField.classList.remove("invalid");
        }
      
        // Hide and show password
        const eyeIcons = document.querySelectorAll(".show-hide");
        eyeIcons.forEach((eyeIcon) => {
          eyeIcon.addEventListener("click", () => {
            const pInput = eyeIcon.parentElement.querySelector("input");
            if (pInput.type === "password") {
              eyeIcon.classList.replace("bx-hide", "bx-show");
              return (pInput.type = "text");
            }
            eyeIcon.classList.replace("bx-show", "bx-hide");
            pInput.type = "password";
          });
        });
      
        // Form validation for Login and AJAX request
        loginForm.addEventListener("submit", (e) => {
          e.preventDefault(); // Prevent form submission
          checkEmail(loginEmailInput, loginEmailField);
          checkPassword(loginPassInput, loginPassField);
      
          if (
            !loginEmailField.classList.contains("invalid") &&
            !loginPassField.classList.contains("invalid")
          ) {
            const formData = new FormData(loginForm);
            fetch("login_register.php", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.text())
              .then((data) => {
                console.log(data);
                var user = data.replace("Yes","");
                user = user.replace("No", "");
                if (data.includes("Yes")) {
                  alert("Admin Login successful!");
                  window.location.href = `index.html?admin=yes&user=${user}`;
                } 
                else if (data.includes("No"))
                {
                  alert("User Login successful!");
                  window.location.href = `index.html?admin=no&user=${user}`;
                }
                else {
                  alert("Invalid username or password.");
                }
              })
              .catch((error) => {
                console.error("Error:", error); // Debug: Print error
              });
          }
        });
      
        // Form validation for Register and AJAX request
        registerForm.addEventListener("submit", (e) => {
          e.preventDefault(); // Prevent form submission
          checkEmail(registerEmailInput, registerEmailField);
          checkPassword(registerPassInput, registerPassField);
      
          if (
            !registerEmailField.classList.contains("invalid") &&
            !registerPassField.classList.contains("invalid")
          ) {
            const formData = new FormData(registerForm);
            fetch("login_register.php", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.text())
              .then((data) => {
                console.log(data); // Debug: Print server response
                if (data.includes("Rec")) {
                  alert("Registration successful!");
                  window.location.href = "index.html";
                  // Add any further actions, like clearing the form or redirecting
                } else {
                  alert("Registration failed. Please try again.");
                }
              })
              .catch((error) => {
                console.error("Error:", error); // Debug: Print error
              });
          }
        });
      
        // Add real-time validation on keyup
        loginEmailInput.addEventListener("keyup", () =>
          checkEmail(loginEmailInput, loginEmailField)
        );
        loginPassInput.addEventListener("keyup", () =>
          checkPassword(loginPassInput, loginPassField)
        );
      
        registerEmailInput.addEventListener("keyup", () =>
          checkEmail(registerEmailInput, registerEmailField)
        );
        registerPassInput.addEventListener("keyup", () =>
          checkPassword(registerPassInput, registerPassField)
        );
      });
      </script>
      
      
  </body>
</html>
